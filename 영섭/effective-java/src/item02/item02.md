# 생성자에 매개변수가 많다면 빌더를 고려하라

정적 팩터리와 생성자에는 선택적 매개변수가 많을 때 적절히 대응하기가 어려움

## 점층적 생성자 패턴

매개변수 개수가 다른 생성자를 여러 개 만들어서, 적은 매개변수를 받는 생성자가 많은 매개변수를 받는 생성자를 호출하는 방식(**생성자 체이닝**을 사용)

### 단점

- 매개변수가 많아질수록 클라이언트 코드를 작성하거나 읽기 어려움
- 원하지 않는 매개변수에도 값을 지정해야 함

## 자바빈즈 패턴

매개변수가 없는 생성자로 객체를 만든 후, 세터 메서드들을 호출해 매개변수를 설정하는 방식

### 단점

- 객체 하나를 만들기 위해 여러 메서드를 호출해야 함
- 객체가 완전히 생성되기 전까지 **일관성**이 무너진 상태로 존재함
- 클래스를 불변으로 만들 수 없음
- 스레드 안전성을 보장하려면 추가 작업이 필요

## 빌더 패턴

위의 패턴들의 문제들을 해결하기 위해 별도의 **Builder 클래스**를 만들어 메서드를 활용해 값을 입력받은 후 **build 메서드를 활용**해 최종적으로 하나의 **인스턴스를 생성하여 리턴**하는 패턴

### 특징

- **메서드 체이닝** 방식으로 **플루언트 API** 제공
  > 플루언트 API란?
  > 
  > 메서드 체이닝을 통해 마치 자연어(natural language)처럼 읽히도록 설계된 API
- 각 세터 메서드는 빌더 자신을 반환하여 연쇄 호출 가능

### 장점

- 읽기 쉽고 쓰기 쉬운 코드
- **불변성(Immutability)** 보장: 빌더로부터 만들어진 객체는 불변
- `build()` 메서드에서 **불변식(invariant) 검증** 가능
    - 잘못된 매개변수 조합을 런타임에 검출
- **계층적으로 설계된 클래스**와 함께 쓰기 좋음
    - 추상 클래스는 추상 빌더를, 구체 클래스는 구체 빌더를 갖게 함
- 가변인수 매개변수를 여러 개 사용할 수 있음

### 단점

- 객체를 만들려면 빌더부터 만들어야 함 (성능에 민감한 상황에서는 문제가 될 수 있음)
- 점층적 생성자 패턴보다 코드가 장황함
- **매개변수가 4개 이상**일 때 값어치를 함
    - API는 시간이 지날수록 매개변수가 많아지는 경향이 있으므로 애초에 빌더로 시작하는 편이 나을 때가 많음

### 참고

- Lombok의 `@Builder` 어노테이션을 사용하면 빌더 패턴의 보일러플레이트 코드를 줄일 수 있음