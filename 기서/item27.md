## 5장 제네릭

### 아이템 27, 비검사 경고를 제거하라

### 비검사 경고란?

- 컴파일러가 타입 안정성을 확인하는데 필요한 정보가 충분치 않을 때 발생하는 경고
- 모든 비검사 경고는 런타임에 `ClassCastException`을 일으킬 수 있는 잠재적 가능성을 뜻한다.

**예시:**

```java
// ❌ 비검사 경고 발생
Set names = new HashSet();
Set<String> strings = new HashSet();  // 타입 매개변수 누락
```

### 비검사 경고 제거 방법

**규칙:**

1. 비검사 경고를 제거할 수 있으면 가능한 한 모두 제거해야 한다
2. 제거할 수 없는 경우 `@SuppressWarnings("unchecked")`을 붙여주어야 한다

#### 다이아몬드 연산자 사용

**문제가 있는 코드:**

```java
Set<String> strings = new HashSet();  // ❌ 비검사 경고
```

**해결 방법:**

```java
// 자바 7부터 지원하는 다이아몬드 연산자(<>) 사용
Set<String> strings = new HashSet<>();  // ✅ 경고 제거
```

**다이아몬드 연산자의 장점:**

- 타입 매개변수를 명시하지 않고 `<>`만으로 해결 가능
- 컴파일러가 올바른 실제 타입 매개변수를 추론해줌
- 코드가 간결해짐

### @SuppressWarnings 애너테이션

**사용 시점:**

- 경고를 제거할 수는 없지만 타입 안전하다고 확신할 수 있다면 사용
- 그 코드는 경고 없이 컴파일되겠지만, 런타임에는 여전히 `ClassCastException`을 던질 수 있다.

**주의사항:**

1. **가능한 한 좁은 범위에 적용**
    - `@SuppressWarnings` 애너테이션은 개별 지역변수 선언부터 클래스 전체까지 어떤 선언에도 달 수 있다
    - 하지만 항상 가능한 한 좁은 범위에 적용하자

2. **지역변수로 옮기기**
    - 한 줄이 넘는 메서드나 생성자에 달린 `@SuppressWarnings` 애너테이션을 발견하면 지역변수 선언 쪽으로 옮기자
    - 이를 위해 지역변수를 새로 선언하는 수고를 해야 할 수도 있지만, 그만한 값어치가 있을 것이다

3. **주석으로 이유 명시**
    - `@SuppressWarnings("unchecked")` 애너테이션을 사용할 때면 그 경고를 무시해도 안전한 이유를 항상 주석으로 남겨야 한다
    - 코드가 안전한 근거가 쉽게 떠오르지 않더라도 끝까지 포기하지 말자
    - 근거를 찾는 중에 그 코드가 사실은 안전하지 않다는 걸 발견할 수도 있으니 말이다

**예시:**

```java
public <T> T[] toArray(T[] a) {
    if (a.length < size) {
        /**
         * 생성한 배열의 타입이 매개변수로 받은 배열의 타입과 같으므로 안전하다.
         * Arrays.copyOf는 타입 안전하게 배열을 복사함
         */
        @SuppressWarnings("unchecked")
        T[] result = (T[]) Arrays.copyOf(elements, size, a.getClass());
        return result;
    }

    System.arraycopy(elements, 0, a, 0, size);
    if (a.length > size)
        a[size] = null;
    return a;
}
```

### 요약

**비검사 경고 처리 원칙:**

1. **가능한 한 모두 제거**
    - 대부분의 비검사 경고는 쉽게 제거할 수 있다
    - 다이아몬드 연산자(`<>`)를 사용하여 타입 매개변수 명시

2. **제거할 수 없는 경우**
    - 타입 안전하다고 확신할 수 있다면 `@SuppressWarnings("unchecked")` 사용
    - 가능한 한 좁은 범위에 적용 (변수 선언, 짧은 메서드, 생성자)
    - 클래스 전체에 적용하지 말 것

3. **주석으로 이유 명시**
    - 경고를 무시해도 안전한 이유를 항상 주석으로 남기기
    - 근거를 찾는 과정에서 안전하지 않다는 것을 발견할 수도 있음

**결론:**
- 모든 비검사 경고는 런타임에 `ClassCastException`을 일으킬 수 있는 잠재적 가능성을 뜻하니 최선을 다해 제거하라
- 경고를 없앨 방법을 찾지 못하겠다면, 그 코드가 타입 안전함을 증명하고 가능한 한 범위를 좁혀 애너테이션으로 경고를 숨겨라
- 그런 다음 근거를 주석으로 남겨라





